# Phase-4B Discovery Report (2025-09-08_141423)

---

## Repo & Tooling
- Repo root: `/workspaces/Yalla-london`
- Branch: `feature/phase4a-database`
- Last commit: b6e9c74 2025-09-08 13:56:36 +0000 chore: ignore healthcheck logs (Khaledaun)
- Remote: `https://github.com/Khaledaun/Yalla-london`
- Node: `v22.17.0`, Yarn: `1.22.22`, npm: `9.8.1`

---

## Next.js / Build Setup
- App dir: `/workspaces/Yalla-london/yalla_london/app`
- Next (from package.json): `14.2.28`
- Next config: `next.config.js`

### package.json scripts
```json
{
  "dev": "next dev",
  "build": "next build",
  "start": "next start",
  "lint": "next lint",
  "postinstall": "prisma generate --schema prisma/schema.prisma",
  "phase4a:test2c": "bash -c 'set -e; if [ -f \"yalla_london/app/.env\" ] && [ -d \"yalla_london/app/prisma\" ]; then APP_DIR=\"yalla_london/app\"; elif [ -f \".env\" ] && [ -d \"prisma\" ]; then APP_DIR=\".\"; else echo \"❌ run from repo root or app dir\"; exit 1; fi; ENV_FILE=\"$APP_DIR/.env\"; DIRECT_URL=$(sed -n \"s/^DIRECT_URL=//p\" \"$ENV_FILE\" | tail -n1); command -v psql >/dev/null || (sudo apt-get update -y && sudo apt-get install -y postgresql-client); psql \"$DIRECT_URL\" -c \"select 1;\"; psql \"$DIRECT_URL\" -c \"select count(*) from \\\"Place\\\";\"; psql \"$DIRECT_URL\" -c \"select type, count(*) from \\\"PageTypeRecipe\\\" group by 1 order by 1;\"; psql \"$DIRECT_URL\" -c \"select version, is_active from \\\"RulebookVersion\\\" order by created_at desc limit 1;\"'"
}}
```

---

## Environment (.env) — masked
```env
DIRECT_URL=postgresql://USER:******@aws-1-eu-central-2.pooler.supabase.com:5432/postgres?sslmode
DATABASE_URL=postgresql://USER:******@aws-1-eu-central-2.pooler.supabase.com:5432/postgres?sslmode
```

---

## Prisma
- Prisma CLI: `Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
prisma                  : 6.7.0
@prisma/client          : 6.7.0
Computed binaryTarget   : debian-openssl-1.1.x
Operating System        : linux
Architecture            : x64
Node.js                 : v22.17.0
TypeScript              : 5.2.2
Query Engine (Node-API) : libquery-engine 3cff47a7f5d65c3ea74883f1d736e41d68ce91ed (at node_modules/@prisma/engines/libquery_engine-debian-openssl-1.1.x.so.node)
Schema Engine           : schema-engine-cli 3cff47a7f5d65c3ea74883f1d736e41d68ce91ed (at node_modules/@prisma/engines/schema-engine-debian-openssl-1.1.x)
Schema Wasm             : @prisma/prisma-schema-wasm 6.7.0-36.3cff47a7f5d65c3ea74883f1d736e41d68ce91ed
Default Engines Hash    : 3cff47a7f5d65c3ea74883f1d736e41d68ce91ed
Studio                  : 0.511.0`
- Datasource provider: `postgresql`
- directUrl present: `yes`
- Models: `27`, Enums: `0`
- Migrations count: `2`

### _prisma_migrations snapshot (last 10)
```
Expanded display is on.
-[ RECORD 1 ]--+--------------------------------------
id             | cc66d02b-c64a-423c-b816-317d9cf1f813
migration_name | 20250908063738_phase4a_initial_models
started_at     | 2025-09-08 11:39:49.909545+00
finished_at    | 2025-09-08 11:39:50.080304+00
rolled_back_at | 
-[ RECORD 2 ]--+--------------------------------------
id             | 30d17e33-5eb0-40fb-9033-4ccff2435564
migration_name | 20240101000000_baseline_main
started_at     | 2025-09-08 11:38:34.560016+00
finished_at    | 2025-09-08 11:38:34.560016+00
rolled_back_at | 
-[ RECORD 3 ]--+--------------------------------------
id             | 161d3f6e-8139-4710-8963-0cb6a3338e32
migration_name | 20250908063738_phase4a_initial_models
started_at     | 2025-09-08 11:34:23.464621+00
finished_at    | 
rolled_back_at | 2025-09-08 11:39:48.271401+00
```

---

## Database snapshot
```
  BlogPost  |  Category  |  Place  |  PageTypeRecipe  |  RulebookVersion  
------------+------------+---------+------------------+-------------------
 "BlogPost" | "Category" | "Place" | "PageTypeRecipe" | "RulebookVersion"
(1 row)

 places 
--------
     30
(1 row)

   type    | count 
-----------+-------
 event     |     1
 faq       |     1
 guide     |     1
 itinerary |     1
 list      |     1
 news      |     1
 place     |     1
(7 rows)

  version  | is_active 
-----------+-----------
 2024.09.1 | t
(1 row)
```

---

## Routes (App Router)
### API routes
- api/admin/homepage-layouts/route.ts
- api/admin/scheduled-content/route.ts
- api/admin/settings/route.ts
- api/admin/test-integration/route.ts
- api/admin/update-brand-config/route.ts
- api/analytics/track-event/route.ts
- api/auth/[...nextauth]/route.ts
- api/booking/confirm-payment/route.ts
- api/booking/create-payment-intent/route.ts
- api/content/auto-generate/route.ts
- api/content/schedule/route.ts
- api/cron/auto-generate/route.ts
- api/database/backups/[id]/download/route.ts
- api/database/backups/[id]/restore/route.ts
- api/database/backups/[id]/route.ts
- api/database/backups/route.ts
- api/database/stats/route.ts
- api/generate-content/route.ts
- api/health/route.ts
- api/homepage-blocks/[id]/route.ts
- api/homepage-blocks/publish/route.ts
- api/homepage-blocks/reorder/route.ts
- api/homepage-blocks/route.ts
- api/media/[id]/route.ts
- api/media/[id]/set-role/route.ts
- api/media/route.ts
- api/media/upload/route.ts
- api/newsletter/subscribe/route.ts
- api/search-console/submit-url/route.ts
- api/seo/analyze-content/route.ts
- api/seo/entities/route.ts
- api/seo/generate-meta/route.ts
- api/seo/generate-og-image/route.ts
- api/seo/generate-title/route.ts
- api/seo/internal-links/route.ts
- api/seo/lighthouse-audit/route.ts
- api/seo/optimize-content/route.ts
- api/seo/redirects/route.ts
- api/seo/save-meta/route.ts
- api/signup/route.ts
- api/sitemap/advanced/route.ts
- api/sitemap/enhanced-generate/route.ts
- api/sitemap/generate/route.ts
- api/sitemap/xml-backup/route.ts
- api/social-embeds/[id]/route.ts
- api/social-embeds/[id]/track-usage/route.ts
- api/social-embeds/route.ts
- api/social/embed-data/route.ts
- api/social/generate-reel-script/route.ts
- api/social/instagram-feed/route.ts
- api/test-content-generation/route.ts
- api/webhooks/stripe/route.ts

### Page routes
- about/page.tsx
- admin/page.tsx
- blog/[slug]/page.tsx
- blog/page.tsx
- brand-showcase/page.tsx
- contact/page.tsx
- events/page.tsx
- page.tsx
- recommendations/page.tsx

---

## Tests / QA
- Playwright config present: `yes`
- Jest config present: `no`

---

## Vercel project markers
```json
{"projectId":"prj_6Veo50z7sdGmZZrWbKDJlDDwiNHI","orgId":"team_xpUzS0JxFCX8sfQ8KmHj2oVD","projectName":"yalla-london"}
```

---

_Generated by phase4b-discover.sh_
